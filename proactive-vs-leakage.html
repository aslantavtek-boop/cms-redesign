<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proactive Alerts vs. Leakage Analytics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            line-height: 1.5;
            font-size: 16px;
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #06b6d4 0%, #f59e0b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.75rem;
        }
        
        .page-subtitle {
            font-size: 1.125rem;
            color: #94a3b8;
            max-width: 800px;
            margin: 0 auto;
            margin-bottom: 1.5rem;
        }
        
        /* Navigation */
        .header-nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .nav-link {
            padding: 0.75rem 1.5rem;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            color: #e2e8f0;
            text-decoration: none;
            border-radius: 10px;
            font-size: 0.9375rem;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nav-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
            background: rgba(6, 182, 212, 0.3);
            border-color: #06b6d4;
        }
        
        .nav-link.active {
            background: rgba(6, 182, 212, 0.3);
            border-color: #06b6d4;
            color: #06b6d4;
        }
        
        /* Flow Arrow */
        .flow-section {
            margin: 2rem 0;
            text-align: center;
        }
        
        .flow-label {
            font-size: 0.875rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }
        
        /* Comparison Grid */
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .column {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .column-proactive {
            border-top: 3px solid #06b6d4;
        }
        
        .column-leakage {
            border-top: 3px solid #f59e0b;
        }
        
        /* Cards */
        .card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
        }
        
        .card-header h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }
        
        .card-header.proactive h2 {
            color: #06b6d4;
        }
        
        .card-header.leakage h2 {
            color: #f59e0b;
        }
        
        .tagline {
            font-size: 1rem;
            color: #94a3b8;
            font-style: italic;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #f1f5f9;
        }
        
        .description {
            color: #cbd5e1;
            line-height: 1.7;
            margin-bottom: 1rem;
        }
        
        /* Focus Areas */
        .focus-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .focus-list li {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            font-size: 0.9375rem;
        }
        
        .focus-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
        }
        
        /* Scenario Card */
        .scenario-card {
            background: rgba(71, 85, 105, 0.3);
            border-left: 4px solid #64748b;
            border-radius: 10px;
            padding: 1.25rem;
            line-height: 1.8;
            color: #cbd5e1;
        }
        
        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .kpi-box {
            background: rgba(255, 255, 255, 0.04);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
        }
        
        .kpi-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .kpi-box.proactive .kpi-value {
            color: #06b6d4;
        }
        
        .kpi-box.leakage .kpi-value {
            color: #f59e0b;
        }
        
        .kpi-label {
            font-size: 0.8125rem;
            color: #94a3b8;
        }
        
        /* Workflow Diagram */
        .workflow-section {
            margin: 3rem 0;
            padding: 2rem;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .workflow-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: #f1f5f9;
        }
        
        /* Analytics Strip */
        .analytics-strip {
            margin: 3rem 0;
            padding: 2rem;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .strip-title {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: #f1f5f9;
        }
        
        .charts-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 1.5rem;
        }
        
        .chart-header {
            margin-bottom: 1rem;
        }
        
        .chart-title {
            font-size: 0.875rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        
        .chart-stats {
            display: flex;
            align-items: baseline;
            gap: 0.5rem;
        }
        
        .chart-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #f1f5f9;
        }
        
        .chart-delta {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .chart-delta.up {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .chart-delta.down {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .chart-body {
            margin-top: 1rem;
        }
        
        /* Heatmap */
        .heatmap-grid {
            display: grid;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .heatmap-row {
            display: grid;
            grid-template-columns: 180px repeat(7, 1fr);
            gap: 4px;
            align-items: center;
        }
        
        .heatmap-label {
            font-size: 0.8125rem;
            color: #94a3b8;
            padding-right: 0.5rem;
        }
        
        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        /* Tooltip */
        .tooltip {
            position: fixed;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            font-size: 0.8125rem;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }
        
        .tooltip.visible {
            opacity: 1;
        }
        
        /* Summary Box */
        .summary-box {
            margin: 3rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .summary-text {
            font-size: 1.125rem;
            line-height: 1.8;
            color: #e2e8f0;
        }
        
        .summary-text strong {
            color: #06b6d4;
        }
        
        .summary-text strong:last-of-type {
            color: #f59e0b;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .charts-row {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 1rem 0.5rem;
            }
            
            .page-title {
                font-size: 1.75rem;
            }
            
            .header-nav {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .nav-link {
                width: 100%;
                text-align: center;
            }
            
            .card {
                padding: 1rem;
            }
            
            .heatmap-row {
                grid-template-columns: 140px repeat(7, 1fr);
            }
            
            .heatmap-label {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="page-header">
            <h1 class="page-title">Proactive Alerts vs. Leakage Analytics</h1>
            <p class="page-subtitle">
                Uçtan uca gelir bütünlüğü için tamamlayıcı iki katman: biri faturadan önce hatayı önler, diğeri sonra kaçan geliri bulur.
            </p>
            <div class="header-nav">
                <a href="prd.html" class="nav-link">📄 Product Requirements</a>
                <a href="aeronautical-billing-dashboard.html" class="nav-link">📊 Business Flow Dashboard</a>
                <a href="proactive-vs-leakage.html" class="nav-link active">⚡ Proactive vs. Leakage</a>
            </div>
        </header>

        <!-- Flow Arrow Section -->
        <div class="flow-section">
            <div class="flow-label">Continuous Assurance Cycle</div>
            <svg width="100%" height="60" viewBox="0 0 1200 60" style="max-width: 900px; margin: 0 auto; display: block;">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#06b6d4" />
                    </marker>
                </defs>
                <!-- Main flow line -->
                <path d="M 50 30 L 1150 30" stroke="#475569" stroke-width="2" marker-end="url(#arrowhead)" />
                
                <!-- Labels -->
                <text x="100" y="20" font-size="12" fill="#94a3b8" text-anchor="middle">Alerts (before)</text>
                <circle cx="100" cy="30" r="4" fill="#06b6d4" />
                
                <text x="400" y="20" font-size="12" fill="#94a3b8" text-anchor="middle">Billing</text>
                <circle cx="400" cy="30" r="4" fill="#64748b" />
                
                <text x="700" y="20" font-size="12" fill="#94a3b8" text-anchor="middle">Analytics (after)</text>
                <circle cx="700" cy="30" r="4" fill="#f59e0b" />
                
                <text x="1050" y="20" font-size="12" fill="#94a3b8" text-anchor="middle">Revenue Assurance</text>
                <circle cx="1050" cy="30" r="4" fill="#22c55e" />
            </svg>
        </div>

        <!-- Comparison Grid -->
        <div class="comparison-grid">
            <!-- Proactive Alerts Column -->
            <div class="column column-proactive">
                <!-- Header Card -->
                <div class="card">
                    <div class="card-header proactive">
                        <h2>⚡ Proactive Alerts</h2>
                        <p class="tagline">"Fatura oluşmadan hatayı yakalayın."</p>
                    </div>
                </div>

                <!-- Description Card -->
                <div class="card">
                    <h3 class="card-title">Açıklama</h3>
                    <p class="description">
                        Canlı operasyon ve faturalama verilerini izleyen, eksik/çelişkili kayıtları 
                        <strong>fatura öncesinde</strong> tespit eden erken uyarı katmanı. 
                        Sistem, hatayı değil, hatanın olasılığını önceden fark eder.
                    </p>
                </div>

                <!-- Focus Areas Card -->
                <div class="card">
                    <h3 class="card-title">Odak Alanları</h3>
                    <ul class="focus-list">
                        <li>
                            <span class="focus-icon">✓</span>
                            <span>Gerçek zamanlı veri doğrulama</span>
                        </li>
                        <li>
                            <span class="focus-icon">🔍</span>
                            <span>Eksik/tekrarlı hizmet tespiti</span>
                        </li>
                        <li>
                            <span class="focus-icon">⚙️</span>
                            <span>Tarife versiyon uyumsuzluğu</span>
                        </li>
                        <li>
                            <span class="focus-icon">📡</span>
                            <span>API feed kesintisi uyarısı</span>
                        </li>
                        <li>
                            <span class="focus-icon">💰</span>
                            <span>Erken gelir riski önleme</span>
                        </li>
                    </ul>
                </div>

                <!-- Scenario Card -->
                <div class="card">
                    <h3 class="card-title">Gerçek Senaryo (ADB)</h3>
                    <div class="scenario-card">
                        ADB'de bir uçuşun on-block/off-block saatleri AODB ve hizmet formunda 23 dk farklıdır 
                        → <strong>"Time Inconsistency – High Priority"</strong> uyarısı tetiklenir; 
                        operasyon düzeltir, fatura hatasız çıkar.
                    </div>
                </div>

                <!-- Business Impact Card -->
                <div class="card">
                    <h3 class="card-title">Business Impact</h3>
                    <div class="kpi-grid">
                        <div class="kpi-box proactive">
                            <div class="kpi-value">−30%</div>
                            <div class="kpi-label">Mutabakat Süresi</div>
                        </div>
                        <div class="kpi-box proactive">
                            <div class="kpi-value">−40%</div>
                            <div class="kpi-label">Müşteri İtirazı</div>
                        </div>
                        <div class="kpi-box proactive">
                            <div class="kpi-value">&lt;0.1%</div>
                            <div class="kpi-label">Faturalama Hatası</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leakage Analytics Column -->
            <div class="column column-leakage">
                <!-- Header Card -->
                <div class="card">
                    <div class="card-header leakage">
                        <h2>🔎 Leakage Analytics</h2>
                        <p class="tagline">"Kaçan geliri geri kazanın."</p>
                    </div>
                </div>

                <!-- Description Card -->
                <div class="card">
                    <h3 class="card-title">Açıklama</h3>
                    <p class="description">
                        Geçmiş uçuş/hizmet verisini davranışsal olarak analiz edip 
                        <strong>faturalanmamış olası gelir</strong> fırsatlarını işaretleyen akıllı denetim katmanı. 
                        Benzer operasyonlardan öğrenerek eksik kayıtları tespit eder.
                    </p>
                </div>

                <!-- Focus Areas Card -->
                <div class="card">
                    <h3 class="card-title">Odak Alanları</h3>
                    <ul class="focus-list">
                        <li>
                            <span class="focus-icon">📊</span>
                            <span>Benzer uçuş örüntüsü karşılaştırma</span>
                        </li>
                        <li>
                            <span class="focus-icon">🎯</span>
                            <span>Eksik hizmet tahmini</span>
                        </li>
                        <li>
                            <span class="focus-icon">💡</span>
                            <span>Gelir fırsatı skoru</span>
                        </li>
                        <li>
                            <span class="focus-icon">🧠</span>
                            <span>Kanıta dayalı kurtarma önerileri</span>
                        </li>
                    </ul>
                </div>

                <!-- Scenario Card -->
                <div class="card">
                    <h3 class="card-title">Gerçek Senaryo (ADB)</h3>
                    <div class="scenario-card">
                        Benzer Pegasus A320 uçuşlarının %95'inde yakıt kaydı varken bu uçuşta yok 
                        → <strong>"Unbilled Fuel Service – Confidence 0.89"</strong>. 
                        Finans tek tıkla taslak satır oluşturur.
                    </div>
                </div>

                <!-- Business Impact Card -->
                <div class="card">
                    <h3 class="card-title">Business Impact</h3>
                    <div class="kpi-grid">
                        <div class="kpi-box leakage">
                            <div class="kpi-value">+3–5%</div>
                            <div class="kpi-label">Aylık Recovered Revenue</div>
                        </div>
                        <div class="kpi-box leakage">
                            <div class="kpi-value">%80</div>
                            <div class="kpi-label">Doğruluk Oranı</div>
                        </div>
                        <div class="kpi-box leakage">
                            <div class="kpi-value">−50%</div>
                            <div class="kpi-label">Manuel Audit</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workflow Diagram -->
        <div class="workflow-section">
            <h2 class="workflow-title">Ortak İş Akışı Diyagramı</h2>
            <svg width="100%" height="140" viewBox="0 0 1400 140" style="max-width: 100%; display: block;">
                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                        <polygon points="0 0, 10 3, 0 6" fill="#64748b" />
                    </marker>
                </defs>
                
                <!-- Boxes -->
                <rect x="20" y="40" width="180" height="60" rx="8" fill="rgba(71, 85, 105, 0.4)" stroke="#475569" stroke-width="2"/>
                <text x="110" y="75" font-size="13" fill="#e2e8f0" text-anchor="middle">Flight/Service Event</text>
                
                <rect x="250" y="40" width="180" height="60" rx="8" fill="rgba(6, 182, 212, 0.2)" stroke="#06b6d4" stroke-width="2"/>
                <text x="340" y="70" font-size="13" fill="#e2e8f0" text-anchor="middle">Proactive Alert</text>
                <text x="340" y="85" font-size="13" fill="#e2e8f0" text-anchor="middle">Detected</text>
                
                <rect x="480" y="40" width="180" height="60" rx="8" fill="rgba(71, 85, 105, 0.4)" stroke="#475569" stroke-width="2"/>
                <text x="570" y="75" font-size="13" fill="#e2e8f0" text-anchor="middle">Operator Action</text>
                
                <rect x="710" y="40" width="180" height="60" rx="8" fill="rgba(71, 85, 105, 0.4)" stroke="#475569" stroke-width="2"/>
                <text x="800" y="75" font-size="13" fill="#e2e8f0" text-anchor="middle">Billing Issued</text>
                
                <rect x="940" y="40" width="180" height="60" rx="8" fill="rgba(245, 158, 11, 0.2)" stroke="#f59e0b" stroke-width="2"/>
                <text x="1030" y="70" font-size="13" fill="#e2e8f0" text-anchor="middle">Leakage Analytics</text>
                <text x="1030" y="85" font-size="13" fill="#e2e8f0" text-anchor="middle">Audit</text>
                
                <rect x="1170" y="40" width="200" height="60" rx="8" fill="rgba(34, 197, 94, 0.2)" stroke="#22c55e" stroke-width="2"/>
                <text x="1270" y="70" font-size="13" fill="#e2e8f0" text-anchor="middle">Revenue Assurance</text>
                <text x="1270" y="85" font-size="13" fill="#e2e8f0" text-anchor="middle">Report</text>
                
                <!-- Arrows -->
                <path d="M 200 70 L 250 70" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
                <path d="M 430 70 L 480 70" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
                <path d="M 660 70 L 710 70" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
                <path d="M 890 70 L 940 70" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
                <path d="M 1120 70 L 1170 70" stroke="#64748b" stroke-width="2" marker-end="url(#arrow)"/>
            </svg>
        </div>

        <!-- Analytics Strip -->
        <div class="analytics-strip">
            <h2 class="strip-title">Mini Analitik Şeridi</h2>
            <div class="charts-row">
                <!-- Sparkline Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Alerts per 100 Flights (8w)</div>
                        <div class="chart-stats">
                            <div class="chart-value" id="sparkline-value">14</div>
                            <div class="chart-delta down" id="sparkline-delta">▼ 1</div>
                        </div>
                    </div>
                    <div class="chart-body">
                        <svg id="sparkline-svg" width="100%" height="80"></svg>
                    </div>
                </div>

                <!-- Bar Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Leakage Recovery (₺) by Month (6m)</div>
                        <div class="chart-stats">
                            <div class="chart-value" id="bar-value">₺605K</div>
                            <div class="chart-delta up" id="bar-delta">▲ 8%</div>
                        </div>
                    </div>
                    <div class="chart-body">
                        <svg id="bar-svg" width="100%" height="120"></svg>
                    </div>
                </div>

                <!-- Heatmap -->
                <div class="chart-container" style="grid-column: 1 / -1;">
                    <div class="chart-header">
                        <div class="chart-title">Alert Types × Last 7 Days</div>
                    </div>
                    <div class="chart-body">
                        <div class="heatmap-grid" id="heatmap"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Box -->
        <div class="summary-box">
            <p class="summary-text">
                <strong>Proactive Alerts</strong> faturadan önce hatayı önler; 
                <strong>Leakage Analytics</strong> faturadan sonra kaçan geliri bulur. 
                Birlikte, uçtan uca gelir bütünlüğünü sağlarlar.
            </p>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // ============================================
        // Data
        // ============================================
        const alertsPer100 = [18, 22, 19, 24, 20, 17, 15, 14];
        
        const recovery = [
            { month: "May", value: 420000 },
            { month: "Jun", value: 470000 },
            { month: "Jul", value: 510000 },
            { month: "Aug", value: 495000 },
            { month: "Sep", value: 560000 },
            { month: "Oct", value: 605000 }
        ];

        const alertTypes = [
            "Time Inconsistency",
            "Missing Service",
            "Tariff Mismatch",
            "Duplicate Entry"
        ];

        const days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];

        const heatmapData = [
            [5, 7, 4, 6, 8, 3, 2],
            [9, 6, 7, 5, 4, 6, 3],
            [3, 4, 2, 5, 3, 4, 2],
            [2, 3, 4, 2, 1, 3, 2]
        ];

        // ============================================
        // Helper Functions
        // ============================================
        function scaleLinear(domainMin, domainMax, rangeMin, rangeMax) {
            return function(value) {
                return rangeMin + ((value - domainMin) / (domainMax - domainMin)) * (rangeMax - rangeMin);
            };
        }

        function toShortCurrency(n) {
            if (n >= 1000000) {
                return '₺' + (n / 1000000).toFixed(1) + 'M';
            }
            if (n >= 1000) {
                return '₺' + Math.round(n / 1000) + 'K';
            }
            return '₺' + n;
        }

        function sparklinePath(data, width, height, padding) {
            const minVal = Math.min(...data);
            const maxVal = Math.max(...data);
            const scaleX = scaleLinear(0, data.length - 1, padding, width - padding);
            const scaleY = scaleLinear(minVal, maxVal, height - padding, padding);

            let path = '';
            data.forEach((val, i) => {
                const x = scaleX(i);
                const y = scaleY(val);
                if (i === 0) {
                    path += `M ${x} ${y}`;
                } else {
                    path += ` L ${x} ${y}`;
                }
            });

            return path;
        }

        // ============================================
        // Sparkline Chart
        // ============================================
        function renderSparkline() {
            const svg = document.getElementById('sparkline-svg');
            const width = svg.clientWidth;
            const height = 80;
            const padding = 10;

            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const minVal = Math.min(...alertsPer100);
            const maxVal = Math.max(...alertsPer100);
            const scaleX = scaleLinear(0, alertsPer100.length - 1, padding, width - padding);
            const scaleY = scaleLinear(minVal, maxVal, height - padding, padding);

            // Area path
            let areaPath = sparklinePath(alertsPer100, width, height, padding);
            areaPath += ` L ${width - padding} ${height - padding} L ${padding} ${height - padding} Z`;

            const area = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            area.setAttribute('d', areaPath);
            area.setAttribute('fill', 'rgba(6, 182, 212, 0.2)');
            area.setAttribute('stroke', 'none');
            svg.appendChild(area);

            // Line path
            const linePath = sparklinePath(alertsPer100, width, height, padding);
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            line.setAttribute('d', linePath);
            line.setAttribute('fill', 'none');
            line.setAttribute('stroke', '#06b6d4');
            line.setAttribute('stroke-width', '2');
            svg.appendChild(line);

            // Last point circle
            const lastX = scaleX(alertsPer100.length - 1);
            const lastY = scaleY(alertsPer100[alertsPer100.length - 1]);
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', lastX);
            circle.setAttribute('cy', lastY);
            circle.setAttribute('r', '4');
            circle.setAttribute('fill', '#06b6d4');
            svg.appendChild(circle);

            // Update stats
            const lastValue = alertsPer100[alertsPer100.length - 1];
            const prevValue = alertsPer100[alertsPer100.length - 2];
            const delta = lastValue - prevValue;
            
            document.getElementById('sparkline-value').textContent = lastValue;
            const deltaEl = document.getElementById('sparkline-delta');
            deltaEl.textContent = delta >= 0 ? `▲ ${delta}` : `▼ ${Math.abs(delta)}`;
            deltaEl.className = 'chart-delta ' + (delta >= 0 ? 'up' : 'down');
        }

        // ============================================
        // Bar Chart
        // ============================================
        function renderBarChart() {
            const svg = document.getElementById('bar-svg');
            const width = svg.clientWidth;
            const height = 120;
            const padding = 30;
            const barWidth = (width - 2 * padding) / recovery.length - 10;

            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const maxVal = Math.max(...recovery.map(d => d.value));
            const scaleY = scaleLinear(0, maxVal, height - padding, padding);

            recovery.forEach((item, i) => {
                const x = padding + i * ((width - 2 * padding) / recovery.length);
                const barHeight = (height - padding) - scaleY(item.value);
                const y = scaleY(item.value);

                // Bar
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', barWidth);
                rect.setAttribute('height', barHeight);
                rect.setAttribute('fill', i === recovery.length - 1 ? '#f59e0b' : 'rgba(245, 158, 11, 0.5)');
                rect.setAttribute('rx', '4');
                svg.appendChild(rect);

                // Month label
                const monthText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                monthText.setAttribute('x', x + barWidth / 2);
                monthText.setAttribute('y', height - 5);
                monthText.setAttribute('text-anchor', 'middle');
                monthText.setAttribute('font-size', '10');
                monthText.setAttribute('fill', '#94a3b8');
                monthText.textContent = item.month;
                svg.appendChild(monthText);

                // Value label
                const valueText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                valueText.setAttribute('x', x + barWidth / 2);
                valueText.setAttribute('y', y - 5);
                valueText.setAttribute('text-anchor', 'middle');
                valueText.setAttribute('font-size', '10');
                valueText.setAttribute('fill', '#e2e8f0');
                valueText.textContent = toShortCurrency(item.value);
                svg.appendChild(valueText);
            });

            // Update stats
            const lastValue = recovery[recovery.length - 1].value;
            const prevValue = recovery[recovery.length - 2].value;
            const deltaPercent = Math.round(((lastValue - prevValue) / prevValue) * 100);
            
            document.getElementById('bar-value').textContent = toShortCurrency(lastValue);
            const deltaEl = document.getElementById('bar-delta');
            deltaEl.textContent = deltaPercent >= 0 ? `▲ ${deltaPercent}%` : `▼ ${Math.abs(deltaPercent)}%`;
            deltaEl.className = 'chart-delta ' + (deltaPercent >= 0 ? 'up' : 'down');
        }

        // ============================================
        // Heatmap
        // ============================================
        function renderHeatmap() {
            const container = document.getElementById('heatmap');
            const maxVal = 9;

            // Header row
            const headerRow = document.createElement('div');
            headerRow.className = 'heatmap-row';
            headerRow.innerHTML = '<div class="heatmap-label"></div>';
            days.forEach(day => {
                const cell = document.createElement('div');
                cell.className = 'heatmap-label';
                cell.style.textAlign = 'center';
                cell.style.fontSize = '0.75rem';
                cell.textContent = day;
                headerRow.appendChild(cell);
            });
            container.appendChild(headerRow);

            // Data rows
            heatmapData.forEach((row, rowIndex) => {
                const rowEl = document.createElement('div');
                rowEl.className = 'heatmap-row';

                // Label
                const label = document.createElement('div');
                label.className = 'heatmap-label';
                label.textContent = alertTypes[rowIndex];
                rowEl.appendChild(label);

                // Cells
                row.forEach((value, colIndex) => {
                    const cell = document.createElement('div');
                    cell.className = 'heatmap-cell';
                    const opacity = scaleLinear(0, maxVal, 0.15, 0.9)(value);
                    cell.style.background = `rgba(6, 182, 212, ${opacity})`;
                    
                    // Tooltip on hover
                    cell.addEventListener('mouseenter', (e) => {
                        showTooltip(e, `${alertTypes[rowIndex]} · ${days[colIndex]}: ${value}`);
                    });
                    cell.addEventListener('mouseleave', hideTooltip);
                    cell.addEventListener('mousemove', (e) => {
                        updateTooltipPosition(e);
                    });

                    rowEl.appendChild(cell);
                });

                container.appendChild(rowEl);
            });
        }

        // ============================================
        // Tooltip
        // ============================================
        function showTooltip(event, text) {
            const tooltip = document.getElementById('tooltip');
            tooltip.textContent = text;
            tooltip.classList.add('visible');
            updateTooltipPosition(event);
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.classList.remove('visible');
        }

        function updateTooltipPosition(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = (event.pageX + 15) + 'px';
            tooltip.style.top = (event.pageY - 10) + 'px';
        }

        // ============================================
        // Initialize
        // ============================================
        window.addEventListener('load', () => {
            renderSparkline();
            renderBarChart();
            renderHeatmap();
        });

        window.addEventListener('resize', () => {
            document.getElementById('sparkline-svg').innerHTML = '';
            document.getElementById('bar-svg').innerHTML = '';
            renderSparkline();
            renderBarChart();
        });
    </script>
</body>
</html>

